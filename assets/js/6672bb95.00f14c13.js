"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6049],{1542:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return m}});var o=n(7462),i=n(3366),a=(n(7294),n(3905)),r=["components"],l={id:"counter",title:"Micropayment Counter",sidebar_label:"Micropayment counter"},s=void 0,c={unversionedId:"counter",id:"counter",title:"Micropayment Counter",description:"Web Monetization lets you count exactly how much you made from a given visitor. The amount updates in real-time as more micropayments come in. Like any animated effect it should be used sparingly, but it can be a cool way to show your visitors exactly how much they're supporting you!",source:"@site/docs/counter.md",sourceDirName:".",slug:"/counter",permalink:"/docs/counter",draft:!1,editUrl:"https://github.com/WICG/webmonetization/tree/main/docs/counter.md",tags:[],version:"current",frontMatter:{id:"counter",title:"Micropayment Counter",sidebar_label:"Micropayment counter"},sidebar:"docs",previous:{title:"Remove ads",permalink:"/docs/remove-ads"},next:{title:"Probabilistic revenue sharing",permalink:"/docs/probabilistic-rev-sharing"}},u={},m=[{value:"Code",id:"code",level:2},{value:"How does it work?",id:"how-does-it-work",level:2},{value:"Interactive example",id:"interactive-example",level:2}],d={toc:m},p="wrapper";function h(e){var t=e.components,n=(0,i.Z)(e,r);return(0,a.kt)(p,(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Web Monetization lets you count exactly how much you made from a given visitor. The amount updates in real-time as more micropayments come in. Like any animated effect it should be used sparingly, but it can be a cool way to show your visitors exactly how much they're supporting you!"),(0,a.kt)("p",null,"This example shows you how to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"monetization")," event to count how much you've made off of micropayments from a given visitor."),(0,a.kt)("h2",{id:"code"},"Code"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<head>\n  \x3c!-- this should be set to your own payment pointer --\x3e\n  <link rel="monetization" href="https://wallet.example.com/alice" />\n\n  <script>\n  let total = 0;\n\n  if (window.MonetizationEvent) {\n    const link = document.querySelector(\'link[rel="monetization"]\');\n\n    link.addEventListener("monetization", (event) => {\n      const {\n        amountSent: { value, currency },\n      } = event;\n      console.log(`Browser sent ${currency} ${value}.`);\n\n      if (total === 0) {\n        document.getElementById("currency").innerText = currency;\n      }\n\n      total += Number(value);\n\n      document.getElementById("total").innerText = total.toFixed(9);\n    });\n  }  \n  <\/script>\n</head>\n\n<body>\n  <p>\n    Thanks to you, I\'ve made\n    <span id="total">nothing (yet)</span>\n    <span id="currency"></span>\n  </p>\n</body>\n')),(0,a.kt)("h2",{id:"how-does-it-work"},"How does it work?"),(0,a.kt)("p",null,"First, we'll bind the ",(0,a.kt)("inlineCode",{parentName:"p"},"monetization")," event if the visitor is web monetized (",(0,a.kt)("inlineCode",{parentName:"p"},"window.MonetizationEvent")," is defined). "),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"monetization")," event contains details about the payments that occur. The ",(0,a.kt)("inlineCode",{parentName:"p"},"amountSent")," property of the event returns the amount (",(0,a.kt)("inlineCode",{parentName:"p"},"value"),") and currency code of the last successful payment."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'  if (window.MonetizationEvent) {\n    const link = document.querySelector(\'link[rel="monetization"]\');\n\n    link.addEventListener("monetization", (event) => {\n      const {\n      amountSent: { value, currency },\n    } = event;\n    console.log(`Browser sent ${currency} ${value}.`);\n')),(0,a.kt)("p",null,"The currency is set on the first payment and doesn't change. It represents the received currency, which may be different than the site visitor's preferred currency. "),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"currency")," is a three-letter code, like ",(0,a.kt)("inlineCode",{parentName:"p"},"USD"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"EUR"),", or ",(0,a.kt)("inlineCode",{parentName:"p"},"GBP"),". This code gets written to the ",(0,a.kt)("inlineCode",{parentName:"p"},"currency")," span on the page."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'// initialize currency on first progress event\n    if (total === 0) {\n      document.getElementById("currency").innerText = currency;\n    }\n')),(0,a.kt)("p",null,"The amount in ",(0,a.kt)("inlineCode",{parentName:"p"},"value")," is an integer, which we add to our total. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"    total += Number(value);\n")),(0,a.kt)("p",null,"Finally, we update the text on the page with the new total. We want the total to be in a readable format, so we convert the number to a string and round it to a specified number of decimals, which in this example is 9. This formatted version of the amount gets written to the ",(0,a.kt)("inlineCode",{parentName:"p"},"total")," span on the page."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'    document.getElementById("total").innerText = total.toFixed(9);\n')),(0,a.kt)("h2",{id:"interactive-example"},"Interactive example"),(0,a.kt)("p",null,"This example simulates showing the amount being streamed from a web monetized visitor. The example doesn't require you to have Web Monetization enabled in your browser. No real payments are occurring."),(0,a.kt)("p",null,"Click the ",(0,a.kt)("strong",{parentName:"p"},"View as Web Monetized/non-Web Monetized visitor")," button to toggle your monetization state."),(0,a.kt)("p",null,"If you see the source files instead of the example, click ",(0,a.kt)("strong",{parentName:"p"},"View App")," in the bottom right."),(0,a.kt)("div",{className:"glitch-embed-wrap",style:{height:"420px",width:"100%"}},(0,a.kt)("iframe",{src:"https://glitch.com/embed/#!/embed/wm2-count-revenue?path=README.md&previewSize=100",title:"wm-count-revenue on Glitch",allow:"geolocation; microphone; camera; midi; vr; encrypted-media",style:{height:"100%",width:"100%",border:"0"}})))}h.isMDXComponent=!0}}]);